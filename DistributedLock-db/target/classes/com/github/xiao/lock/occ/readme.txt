基于版本号的乐观锁
/**
 * 乐观并发控制（又名“乐观锁”，Optimistic Concurrency Control，缩写“OCC”） mysql乐观锁应用
 *
 * * 【*************商品减库存案例*****************】 一般的实现乐观锁的方式就是记录数据版本。
 * 数据版本,为数据增加的一个版本标识。当读取数据时，将版本标识的值一同读出，数据每更新一次，
 * 同时对版本标识进行更新。当我们提交更新的时候，判断数据库表对应记录的当前版本信息与第一次取出来的版本标识进行比对，
 * 如果数据库表当前版本号与第一次取出来的版本标识值相等，则予以更新，否则认为是过期数据。 实现数据版本有两种方式，第一种是使用版本号，第二种是使用时间戳。
 * 
 * 步骤=============== 一、查询相关商品 select id,goods_name,stock,version from test_goods
 * where id =? //相关版本号查出 二、修改库存 update test_goods set
 * stock=stock-1,version=version+1 where id =? and version=?//修改版本号
 */
 
 
 总结：
 
 1.相比较悲观锁，乐观锁更适用于写少的情况，如果并发写过高，会出现retry。
 2.连接占用问题依旧存在。